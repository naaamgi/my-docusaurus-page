---
sidebar_position: 6
title: MySQL Dumping & Hash Cracking
---

# MySQL 덤핑 & 해시 크래킹

## 원격 데이터베이스 덤핑

### 전체 데이터베이스 덤프

```bash
mysqldump -u <user> -p'<password>' -P <port> -h <ip> <database> > dump.sql

# 예시
mysqldump -u root -p'root' -h 192.168.1.10 -P 3306 production > production.sql
```

### 특정 테이블 덤프

```bash
mysqldump -u <user> -p'<password>' -P <port> -h <ip> <database> <table> > table.sql

# 예시
mysqldump -u root -p'root' -h 192.168.1.10 -P 3306 production users > users.sql
```

### 조건부 덤프

```bash
# WHERE 절 사용
mysqldump -u <user> -p'<password>' -P <port> -h <ip> <database> <table> \
  --where="<column> LIKE '%<pattern>%'" > filtered.sql

# 예시: username에 'admin' 포함된 레코드만
mysqldump -u root -p'root' -h 192.168.1.10 -P 3306 production users \
  --where="username LIKE '%admin%'" > admin.sql
```

### SSL 비활성화

```bash
# SSL 연결 문제 시
mysqldump -u root -p'root' -h <ip> -P <port> <database> --ssl=FALSE > dump.sql
```

## 덤프 파일 파싱

### 수동 파싱 (grep, cut 사용)

```bash
# INSERT 문에서 해시 추출
cat dump.sql | grep -i 'insert into `users`' -A 26 | \
  tr -d "'" | cut -d ',' -f 3 | tail -5 > hashes.txt

# 설명:
# -A 26: INSERT 이후 26줄 출력
# tr -d "'": 따옴표 제거
# cut -d ',' -f 3: 쉼표로 구분된 3번째 필드 (비밀번호)
# tail -5: 마지막 5개만 (해시된 비밀번호)
```

### SQL에서 직접 추출

```sql
-- MySQL 접속 후
USE <database>;
SELECT password FROM users;
SELECT username, password FROM users WHERE username LIKE '%admin%';
```

## 해시 크래킹

### 1. 해시 알고리즘 식별

```bash
# hash-identifier 사용
hash-identifier

# 해시 입력
HASH: 5f4dcc3b5aa765d61d8327deb882cf99

# 출력
Possible Hashs:
[+] MD5
[+] Domain Cached Credentials
```

### 2. John the Ripper로 크래킹

```bash
# 기본 크래킹
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# 해시 포맷 지정 (MD5)
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# 결과를 특정 파일에 저장
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt \
  --pot=cracked.txt hashes.txt

# 크래킹된 결과 확인
john --show hashes.txt
```

### 3. Hashcat으로 크래킹

```bash
# MD5 크래킹
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# NTLM 크래킹
hashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# SHA1 크래킹
hashcat -m 100 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# 결과 확인
hashcat -m 0 hashes.txt --show
```

### 주요 해시 타입 (Hashcat)

| 알고리즘 | Mode | 예시 |
|----------|------|------|
| MD5 | 0 | 5f4dcc3b5aa765d61d8327deb882cf99 |
| SHA1 | 100 | 5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8 |
| SHA256 | 1400 | 5e884898da28047151d0e56f8dc6292... |
| NTLM | 1000 | b4b9b02e6f09a9bd760f388b67351e2b |
| bcrypt | 3200 | $2a$05$LhayLxezLhK1LhWvKxCyLO... |

## 실전 예시

### 전체 워크플로우

```bash
# 1. 데이터베이스 덤프
mysqldump -u root -p'root' -h 192.168.1.10 -P 3306 production users > users.sql

# 2. 해시 추출
cat users.sql | grep INSERT | cut -d "'" -f 4 > hashes.txt

# 3. 해시 타입 확인
hash-identifier
# 입력: 첫 번째 해시

# 4. 크래킹 (John)
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# 5. 결과 확인
john --show hashes.txt
```

### 크래킹 결과 활용

```bash
# 크래킹된 계정 정보로 SSH 시도
ssh user@<target>

# FTP 시도
ftp <target>

# MySQL 재접속
mysql -u <user> -p'<cracked_password>' -h <target>
```

## 주요 명령어 요약

```bash
# 데이터베이스 덤프
mysqldump -u root -p -h <ip> -P <port> <database> > dump.sql

# 테이블 덤프
mysqldump -u root -p -h <ip> -P <port> <database> <table> > table.sql

# 해시 식별
hash-identifier

# John the Ripper
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
john --show hashes.txt

# Hashcat
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt
hashcat -m 0 hashes.txt --show

# RockYou 압축 해제
sudo gzip -d /usr/share/wordlists/rockyou.txt.gz
```

## 해시 크래킹 최적화

### Wordlist 선택

```bash
# 작은 wordlist (빠른 테스트)
/usr/share/wordlists/fasttrack.txt

# 중간 wordlist
/usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt

# 큰 wordlist (포괄적)
/usr/share/wordlists/rockyou.txt

# 커스텀 wordlist 생성
crunch 8 8 -t @@@@%%%% > custom.txt
```

### 룰 기반 공격

```bash
# John with rules
john --format=Raw-MD5 --wordlist=wordlist.txt --rules hashes.txt

# Hashcat with rules
hashcat -m 0 -a 0 hashes.txt wordlist.txt -r /usr/share/hashcat/rules/best64.rule
```

## 문제 해결

### John이 해시를 인식하지 못하는 경우

```bash
# 포맷 확인
john --list=formats | grep -i md5

# 다양한 포맷 시도
john --format=Raw-MD5 hashes.txt
john --format=md5crypt hashes.txt
```

### Hashcat GPU 오류

```bash
# CPU 모드로 강제
hashcat -m 0 -a 0 -D 1 hashes.txt wordlist.txt
```
